<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate provides additional functionality for `OsStr` and `OsString`, without resorting to panics or corruption for invalid UTF-8. Thus, familiar methods from `str` and `String` can be used."><title>os_str_bytes - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="os_str_bytes" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../os_str_bytes/index.html">os_<wbr>str_<wbr>bytes</a><span class="version">7.0.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">os_str_bytes</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/os_str_bytes/lib.rs.html#1-921">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate provides additional functionality for <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> and
<a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a>, without resorting to panics or corruption for invalid UTF-8.
Thus, familiar methods from <a href="https://doc.rust-lang.org/1.82.0/std/primitive.str.html" title="primitive str"><code>str</code></a> and <a href="https://doc.rust-lang.org/1.82.0/alloc/string/struct.String.html" title="struct alloc::string::String"><code>String</code></a> can be used.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>The most important trait included is <a href="trait.OsStrBytesExt.html" title="trait os_str_bytes::OsStrBytesExt"><code>OsStrBytesExt</code></a>, which provides
methods analagous to those of <a href="https://doc.rust-lang.org/1.82.0/std/primitive.str.html" title="primitive str"><code>str</code></a> but for <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>. These methods will
never panic for invalid UTF-8 in a platform string, so they can be used to
manipulate <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> values with the same simplicity possible for <a href="https://doc.rust-lang.org/1.82.0/std/primitive.str.html" title="primitive str"><code>str</code></a>.</p>
<p>Additionally, the following wrappers are provided. They are primarily
legacy types from when this crate needed to perform more frequent encoding
conversions. However, they may be useful for their trait implementations.</p>
<ul>
<li><a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> is a wrapper for <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>.</li>
<li><a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a> is a wrapper for <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a>.</li>
</ul>
<h2 id="user-input"><a class="doc-anchor" href="#user-input">§</a>User Input</h2>
<p>Most methods in this crate should not be used to convert byte sequences
that did not originate from <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> or a related struct. The encoding
used by this crate is an implementation detail, so it does not make sense
to expose it to users.</p>
<p>For user input with an unknown encoding similar to UTF-8, use the following
IO-safe methods, which avoid errors when <a href="https://doc.rust-lang.org/std/io/struct.Stdout.html#note-windows-portability-considerations">writing to streams on
Windows</a>. These methods will not accept or return
byte sequences that are invalid for input and output streams. Therefore,
they can be used to convert between bytes strings exposed to users and
platform strings.</p>
<ul>
<li><a href="trait.OsStrBytes.html#tymethod.from_io_bytes" title="associated function os_str_bytes::OsStrBytes::from_io_bytes"><code>OsStrBytes::from_io_bytes</code></a></li>
<li><a href="trait.OsStrBytes.html#tymethod.to_io_bytes" title="method os_str_bytes::OsStrBytes::to_io_bytes"><code>OsStrBytes::to_io_bytes</code></a></li>
<li><a href="trait.OsStrBytes.html#tymethod.to_io_bytes_lossy" title="method os_str_bytes::OsStrBytes::to_io_bytes_lossy"><code>OsStrBytes::to_io_bytes_lossy</code></a></li>
<li><a href="trait.OsStringBytes.html#tymethod.from_io_vec" title="associated function os_str_bytes::OsStringBytes::from_io_vec"><code>OsStringBytes::from_io_vec</code></a></li>
<li><a href="trait.OsStringBytes.html#tymethod.into_io_vec" title="method os_str_bytes::OsStringBytes::into_io_vec"><code>OsStringBytes::into_io_vec</code></a></li>
<li><a href="trait.OsStringBytes.html#tymethod.into_io_vec_lossy" title="method os_str_bytes::OsStringBytes::into_io_vec_lossy"><code>OsStringBytes::into_io_vec_lossy</code></a></li>
</ul>
<h2 id="features"><a class="doc-anchor" href="#features">§</a>Features</h2>
<p>These features are optional and can be enabled or disabled in a
“Cargo.toml” file.</p>
<h4 id="default-features"><a class="doc-anchor" href="#default-features">§</a>Default Features</h4>
<ul>
<li>
<p><strong>memchr</strong> -
Changes the implementation to use crate <a href="https://crates.io/crates/memchr">memchr</a> for better performance.
This feature is useless when the “raw_os_str” feature is disabled.</p>
<p>For more information, see <a href="trait.OsStrBytesExt.html#complexity" title="trait os_str_bytes::OsStrBytesExt"><code>OsStrBytesExt</code></a>.</p>
</li>
<li>
<p><strong>raw_os_str</strong> -
Provides:</p>
<ul>
<li><a href="iter/index.html" title="mod os_str_bytes::iter"><code>iter</code></a></li>
<li><a href="struct.NonUnicodeOsStr.html" title="struct os_str_bytes::NonUnicodeOsStr"><code>NonUnicodeOsStr</code></a></li>
<li><a href="trait.OsStrBytesExt.html" title="trait os_str_bytes::OsStrBytesExt"><code>OsStrBytesExt</code></a></li>
<li><a href="trait.Pattern.html" title="trait os_str_bytes::Pattern"><code>Pattern</code></a></li>
<li><a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a></li>
<li><a href="trait.RawOsStrCow.html" title="trait os_str_bytes::RawOsStrCow"><code>RawOsStrCow</code></a></li>
<li><a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a></li>
</ul>
</li>
</ul>
<h4 id="optional-features"><a class="doc-anchor" href="#optional-features">§</a>Optional Features</h4>
<ul>
<li>
<p><strong>checked_conversions</strong> -
Provides:</p>
<ul>
<li>[<code>EncodingError</code>]</li>
<li>[<code>OsStrBytes::from_raw_bytes</code>]</li>
<li>[<code>OsStringBytes::from_raw_vec</code>]</li>
<li>[<code>RawOsStr::cow_from_raw_bytes</code>]</li>
<li>[<code>RawOsString::from_raw_vec</code>]</li>
</ul>
<p>Because this feature should not be used in libraries, the
“OS_STR_BYTES_CHECKED_CONVERSIONS” environment variable must be
defined during compilation.</p>
</li>
<li>
<p><strong>conversions</strong> -
Provides methods that require encoding conversion and may be expensive:</p>
<ul>
<li>[<code>OsStrBytesExt::ends_with_os</code>]</li>
<li>[<code>OsStrBytesExt::starts_with_os</code>]</li>
<li>[<code>RawOsStr::assert_cow_from_raw_bytes</code>]</li>
<li>[<code>RawOsStr::ends_with_os</code>]</li>
<li>[<code>RawOsStr::starts_with_os</code>]</li>
<li>[<code>RawOsStr::to_raw_bytes</code>]</li>
<li>[<code>RawOsString::assert_from_raw_vec</code>]</li>
<li>[<code>RawOsString::into_raw_vec</code>]</li>
<li>[<code>OsStrBytes::assert_from_raw_bytes</code>]</li>
<li>[<code>OsStrBytes::to_raw_bytes</code>]</li>
<li>[<code>OsStringBytes::assert_from_raw_vec</code>]</li>
<li>[<code>OsStringBytes::into_raw_vec</code>]</li>
</ul>
<p>For more information, see <a href="#encoding-conversions">Encoding Conversions</a>.</p>
</li>
</ul>
<h2 id="implementation"><a class="doc-anchor" href="#implementation">§</a>Implementation</h2>
<p>Some methods return <a href="https://doc.rust-lang.org/1.82.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow"><code>Cow</code></a> to account for platform differences. However,
no guarantee is made that the same variant of that enum will always be
returned for the same platform. Whichever can be constructed most
efficiently will be returned.</p>
<p>All traits are <a href="https://rust-lang.github.io/api-guidelines/future-proofing.html#c-sealed">sealed</a>, meaning that they can only be implemented by this
crate. Otherwise, backward compatibility would be more difficult to
maintain for new features.</p>
<h2 id="encoding-conversions"><a class="doc-anchor" href="#encoding-conversions">§</a>Encoding Conversions</h2>
<p>Methods provided by the “conversions” feature use an intentionally
unspecified encoding. It may vary for different platforms, so defining it
would run contrary to the goal of generic string handling. However, the
following invariants will always be upheld:</p>
<ul>
<li>
<p>The encoding will be compatible with UTF-8. In particular, splitting an
encoded byte sequence by a UTF-8–encoded character always produces
other valid byte sequences. They can be re-encoded without error using
<a href="struct.RawOsString.html#method.into_os_string" title="method os_str_bytes::RawOsString::into_os_string"><code>RawOsString::into_os_string</code></a> and similar methods.</p>
</li>
<li>
<p>All characters valid in platform strings are representable. <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> and
<a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a> can always be losslessly reconstructed from extracted bytes.</p>
</li>
</ul>
<p>Note that the chosen encoding may not match how <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> stores these
strings internally, which is undocumented. For instance, the result of
calling <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html#method.len" title="method std::ffi::os_str::OsStr::len"><code>OsStr::len</code></a> will not necessarily match the number of bytes this
crate uses to represent the same string. However, unlike the encoding used
by <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>, the encoding used by this crate can be validated safely using
the following methods:</p>
<ul>
<li>[<code>OsStrBytes::assert_from_raw_bytes</code>]</li>
<li>[<code>RawOsStr::assert_cow_from_raw_bytes</code>]</li>
<li>[<code>RawOsString::assert_from_raw_vec</code>]</li>
</ul>
<p>Concatenation may yield unexpected results without a UTF-8 separator. If
two platform strings need to be concatenated, the only safe way to do so is
using <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsString.html#method.push" title="method std::ffi::os_str::OsString::push"><code>OsString::push</code></a>. This limitation also makes it undesirable to use
the bytes in interchange.</p>
<p>Since this encoding can change between versions and platforms, it should
not be used for storage. The standard library provides implementations of
<a href="https://doc.rust-lang.org/1.82.0/std/os/unix/ffi/os_str/trait.OsStrExt.html" title="trait std::os::unix::ffi::os_str::OsStrExt"><code>OsStrExt</code></a> and <a href="https://doc.rust-lang.org/1.82.0/std/os/unix/ffi/os_str/trait.OsStringExt.html" title="trait std::os::unix::ffi::os_str::OsStringExt"><code>OsStringExt</code></a> for various platforms, which should be
preferred for that use case.</p>
<h2 id="related-crates"><a class="doc-anchor" href="#related-crates">§</a>Related Crates</h2>
<ul>
<li>
<p><a href="https://crates.io/crates/print_bytes">print_bytes</a> -
Used to print byte and platform strings as losslessly as possible.</p>
</li>
<li>
<p><a href="https://crates.io/crates/uniquote">uniquote</a> -
Used to display paths using escapes instead of replacement characters.</p>
</li>
</ul>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::env;
<span class="kw">use </span>std::fs;

<span class="kw">use </span>os_str_bytes::OsStrBytesExt;

<span class="kw">for </span>file <span class="kw">in </span>env::args_os().skip(<span class="number">1</span>) {
    <span class="kw">if </span>!file.starts_with(<span class="string">'-'</span>) {
        <span class="kw">let </span>string = <span class="string">"Hello, world!"</span>;
        fs::write(<span class="kw-2">&amp;</span>file, string)<span class="question-mark">?</span>;
        <span class="macro">assert_eq!</span>(string, fs::read_to_string(file)<span class="question-mark">?</span>);
    }
}</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="iter/index.html" title="mod os_str_bytes::iter">iter</a></div><div class="desc docblock-short">Iterators provided by this crate.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.NonUnicodeOsStr.html" title="struct os_str_bytes::NonUnicodeOsStr">NonUnicode<wbr>OsStr</a></div><div class="desc docblock-short">A container for platform strings containing no unicode characters.</div></li><li><div class="item-name"><a class="struct" href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr">RawOs<wbr>Str</a></div><div class="desc docblock-short">A container providing additional functionality for <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString">RawOs<wbr>String</a></div><div class="desc docblock-short">A container for owned byte strings converted by this crate.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.OsStrBytes.html" title="trait os_str_bytes::OsStrBytes">OsStr<wbr>Bytes</a></div><div class="desc docblock-short">A platform agnostic variant of <a href="https://doc.rust-lang.org/1.82.0/std/os/unix/ffi/os_str/trait.OsStrExt.html" title="trait std::os::unix::ffi::os_str::OsStrExt"><code>OsStrExt</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.OsStrBytesExt.html" title="trait os_str_bytes::OsStrBytesExt">OsStr<wbr>Bytes<wbr>Ext</a></div><div class="desc docblock-short">An extension trait providing additional methods to <a href="https://doc.rust-lang.org/1.82.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.OsStringBytes.html" title="trait os_str_bytes::OsStringBytes">OsString<wbr>Bytes</a></div><div class="desc docblock-short">A platform agnostic variant of <a href="https://doc.rust-lang.org/1.82.0/std/os/unix/ffi/os_str/trait.OsStringExt.html" title="trait std::os::unix::ffi::os_str::OsStringExt"><code>OsStringExt</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.Pattern.html" title="trait os_str_bytes::Pattern">Pattern</a></div><div class="desc docblock-short">Allows a type to be used for searching by <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and <a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.RawOsStrCow.html" title="trait os_str_bytes::RawOsStrCow">RawOs<wbr>StrCow</a></div><div class="desc docblock-short">Extensions to <a href="https://doc.rust-lang.org/1.82.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow"><code>Cow&lt;RawOsStr&gt;</code></a> for additional conversions.</div></li></ul></section></div></main></body></html>